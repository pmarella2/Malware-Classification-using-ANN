import csv
import pandas as pd
from collections import Counter

df = pd.read_csv(
    "~/complete_API_categorized_dataset.csv",
    header=None,
    sep="\n",
)
dfFreq = df[0].str.split(",").apply(lambda x: Counter(x))

with open(
    "~/complete_API_cat_list.txt"
) as apiCalls:
    apiList = list(apiCalls)
    cleanAPIList = []
    for i in apiList:
        cleanAPIList.append(i.strip())

with open(
    "~/complete_API_cat_freq_analyzed.csv",
    "w",
) as f:
    writer = csv.writer(f)
    writer.writerow(cleanAPIList)

    for x in range(len(dfFreq.index)):
        tempList = []
        for APIcall in cleanAPIList:
            tempList.append(dfFreq[x][APIcall])
        writer.writerow(tempList)

with open(
    "~/complete_API_cat_freq_weighted.csv",
    "w",
) as f:
    writer = csv.writer(f)
    writer.writerow(cleanAPIList)

    for x in range(len(dfFreq.index)):
        tempList = []
        for APIcall in cleanAPIList:
            # tempList.append((dfFreq[x][APIcall])/(len(dfFreq[x].keys())))
            tempList.append(
                (dfFreq[x][APIcall]) / (sum(dfFreq[x].values()) - dfFreq[x][""])
            )
        writer.writerow(tempList)
